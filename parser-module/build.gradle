import com.bmuschko.gradle.docker.tasks.image.Dockerfile
import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage

apply plugin: 'java'

group = 'com.bobpaulin.modularity.parser'

jar {
	manifest {
		instruction 'Bundle-Activator', 'com.bobpaulin.modularity.parser.internal.Activator'
	}
}

dependencies {
	compile 'com.bobpaulin.modularity.api:api-module:1.0.0'
	compile 'org.apache.tika:tika-core:1.9'
	compile 'org.apache.tika:tika-parsers:1.9'
	compile 'org.osgi:org.osgi.core:5.0.0'
	compile name: 'org.eclipse.osgi.services.remoteserviceadmin_1.6.100.201506082151'
}


task createDockerfile(type: Dockerfile) {
	destFile = project.file("build/$project.name/Dockerfile")
			from 'java:8u40-b09-jdk'
			maintainer 'Bob Paulin "bob@bobpaulin.com"'
			runCommand 'apt-get update'
			runCommand 'apt-get -y install tesseract-ocr'
			addFile 'files/felix-framework-5.0.1', '/opt/felix-framework-5.0.1'
			workingDir '/opt/felix-framework-5.0.1'
}

task buildImage(type: DockerBuildImage) {
	dependsOn createDockerfile, copyBundleDocker
	inputDir = createDockerfile.destFile.parentFile
	tag = "bobpaulin/$project.name"
}

